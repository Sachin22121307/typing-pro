<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Typing Trainer</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; max-width: 700px; margin: auto; }
  textarea { width: 100%; height: 150px; margin: 10px 0; }
  button { padding: 12px 20px; font-size: 16px; cursor: pointer; }
  #result { margin-top: 20px; font-size: 18px; }
</style>
</head>
<body>
  <h1>Professional Typing Trainer</h1>
  <label for="original">Original text:</label>
  <textarea id="original" placeholder="Paste the passage here"></textarea>

  <label for="typed">Type the passage from memory:</label>
  <textarea id="typed" placeholder="Type here"></textarea>

  <button id="checkBtn">Check</button>

  <div id="result"></div>

  <script>
    let startTime, timerRunning = false;

    const originalEl = document.getElementById('original');
    const typedEl = document.getElementById('typed');
    const checkBtn = document.getElementById('checkBtn');
    const resultDiv = document.getElementById('result');

    typedEl.addEventListener('focus', () => {
      if (!timerRunning) {
        startTime = Date.now();
        timerRunning = true;
      }
    });

    checkBtn.addEventListener('click', async () => {
      if (!timerRunning) {
        alert('Please start typing first.');
        return;
      }
      const original = originalEl.value.trim();
      const typed = typedEl.value.trim();
      if (!original || !typed) {
        alert('Both fields are required.');
        return;
      }

      const durationSec = (Date.now() - startTime) / 1000;
      timerRunning = false;

      const response = await fetch('/api/check', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ original, typed, duration: durationSec })
      });
      const data = await response.json();

      resultDiv.innerHTML = 
        `WPM: ${data.wpm.toFixed(2)}<br>` +
        `Accuracy: ${data.accuracy.toFixed(2)}%<br>` +
        `Errors: ${data.errors}`;
    });
  </script>
</body>
</html>
